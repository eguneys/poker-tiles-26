var e=Object.defineProperty,t=t=>{let n={};for(var r in t)e(n,r,{get:t[r],enumerable:!0});return n};(function(){let e=document.createElement(`link`).relList;if(e&&e.supports&&e.supports(`modulepreload`))return;for(let e of document.querySelectorAll(`link[rel="modulepreload"]`))n(e);new MutationObserver(e=>{for(let t of e)if(t.type===`childList`)for(let e of t.addedNodes)e.tagName===`LINK`&&e.rel===`modulepreload`&&n(e)}).observe(document,{childList:!0,subtree:!0});function t(e){let t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin===`use-credentials`?t.credentials=`include`:e.crossOrigin===`anonymous`?t.credentials=`omit`:t.credentials=`same-origin`,t}function n(e){if(e.ep)return;e.ep=!0;let n=t(e);fetch(e.href,n)}})();var n={context:void 0,registry:void 0,effects:void 0,done:!1,getContextId(){return r(this.context.count)},getNextContextId(){return r(this.context.count++)}};function r(e){let t=String(e),r=t.length-1;return n.context.id+(r?String.fromCharCode(96+r):``)+t}function i(e){n.context=e}function a(){return{...n.context,id:n.getNextContextId(),count:0}}var o={equals:(e,t)=>e===t},s=null,c=_e,l=1,u=2,d={owned:null,cleanups:null,context:null,owner:null},f=null,p=null,m=null,h=null,g=null,_=null,v=null,y=0;function ee(e,t){let n=g,r=f,i=e.length===0,a=t===void 0?r:t,o=i?d:{owned:null,cleanups:null,context:a?a.context:null,owner:a},s=i?e:()=>e(()=>b(()=>C(o)));f=o,g=null;try{return S(s,!0)}finally{g=n,f=r}}function te(e,t){t=t?Object.assign({},o,t):o;let n={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0};return[de.bind(n),e=>(typeof e==`function`&&(e=p&&p.running&&p.sources.has(n)?e(n.tValue):e(n.value)),fe(n,e))]}function ne(e,t,n){let r=he(e,t,!1,l);m&&p&&p.running?_.push(r):pe(r)}function re(e,t,n){c=ye;let r=he(e,t,!1,l),i=ue&&le(ue);i&&(r.suspense=i),(!n||!n.render)&&(r.user=!0),v?v.push(r):pe(r)}function b(e){if(!h&&g===null)return e();let t=g;g=null;try{return h?h.untrack(e):e()}finally{g=t}}function ie(e){re(()=>b(e))}function ae(e){return f===null||(f.cleanups===null?f.cleanups=[e]:f.cleanups.push(e)),e}function oe(e){if(p&&p.running)return e(),p.done;let t=g,n=f;return Promise.resolve().then(()=>{g=t,f=n;let r;return(m||ue)&&(r=p||={sources:new Set,effects:[],promises:new Set,disposed:new Set,queue:new Set,running:!0},r.done||=new Promise(e=>r.resolve=e),r.running=!0),S(e,!1),g=f=null,r?r.done:void 0})}var[se,ce]=te(!1);function le(e){let t;return f&&f.context&&(t=f.context[e.id])!==void 0?t:e.defaultValue}var ue;function de(){let e=p&&p.running;if(this.sources&&(e?this.tState:this.state))if((e?this.tState:this.state)===l)pe(this);else{let e=_;_=null,S(()=>be(this),!1),_=e}if(g){let e=this.observers?this.observers.length:0;g.sources?(g.sources.push(this),g.sourceSlots.push(e)):(g.sources=[this],g.sourceSlots=[e]),this.observers?(this.observers.push(g),this.observerSlots.push(g.sources.length-1)):(this.observers=[g],this.observerSlots=[g.sources.length-1])}return e&&p.sources.has(this)?this.tValue:this.value}function fe(e,t,n){let r=p&&p.running&&p.sources.has(e)?e.tValue:e.value;if(!e.comparator||!e.comparator(r,t)){if(p){let r=p.running;(r||!n&&p.sources.has(e))&&(p.sources.add(e),e.tValue=t),r||(e.value=t)}else e.value=t;e.observers&&e.observers.length&&S(()=>{for(let t=0;t<e.observers.length;t+=1){let n=e.observers[t],r=p&&p.running;r&&p.disposed.has(n)||((r?!n.tState:!n.state)&&(n.pure?_.push(n):v.push(n),n.observers&&xe(n)),r?n.tState=l:n.state=l)}if(_.length>1e6)throw _=[],Error()},!1)}return t}function pe(e){if(!e.fn)return;C(e);let t=y;me(e,p&&p.running&&p.sources.has(e)?e.tValue:e.value,t),p&&!p.running&&p.sources.has(e)&&queueMicrotask(()=>{S(()=>{p&&(p.running=!0),g=f=e,me(e,e.tValue,t),g=f=null},!1)})}function me(e,t,n){let r,i=f,a=g;g=f=e;try{r=e.fn(t)}catch(t){return e.pure&&(p&&p.running?(e.tState=l,e.tOwned&&e.tOwned.forEach(C),e.tOwned=void 0):(e.state=l,e.owned&&e.owned.forEach(C),e.owned=null)),e.updatedAt=n+1,Te(t)}finally{g=a,f=i}(!e.updatedAt||e.updatedAt<=n)&&(e.updatedAt!=null&&`observers`in e?fe(e,r,!0):p&&p.running&&e.pure?(p.sources.add(e),e.tValue=r):e.value=r,e.updatedAt=n)}function he(e,t,n,r=l,i){let a={fn:e,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:f,context:f?f.context:null,pure:n};if(p&&p.running&&(a.state=0,a.tState=r),f===null||f!==d&&(p&&p.running&&f.pure?f.tOwned?f.tOwned.push(a):f.tOwned=[a]:f.owned?f.owned.push(a):f.owned=[a]),h&&a.fn){let[e,t]=te(void 0,{equals:!1}),n=h.factory(a.fn,t);ae(()=>n.dispose());let r=h.factory(a.fn,()=>oe(t).then(()=>r.dispose()));a.fn=t=>(e(),p&&p.running?r.track(t):n.track(t))}return a}function x(e){let t=p&&p.running;if((t?e.tState:e.state)===0)return;if((t?e.tState:e.state)===u)return be(e);if(e.suspense&&b(e.suspense.inFallback))return e.suspense.effects.push(e);let n=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<y);){if(t&&p.disposed.has(e))return;(t?e.tState:e.state)&&n.push(e)}for(let r=n.length-1;r>=0;r--){if(e=n[r],t){let t=e,i=n[r+1];for(;(t=t.owner)&&t!==i;)if(p.disposed.has(t))return}if((t?e.tState:e.state)===l)pe(e);else if((t?e.tState:e.state)===u){let t=_;_=null,S(()=>be(e,n[0]),!1),_=t}}}function S(e,t){if(_)return e();let n=!1;t||(_=[]),v?n=!0:v=[],y++;try{let t=e();return ge(n),t}catch(e){n||(v=null),_=null,Te(e)}}function ge(e){if(_&&=(m&&p&&p.running?ve(_):_e(_),null),e)return;let t;if(p){if(!p.promises.size&&!p.queue.size){let e=p.sources,n=p.disposed;v.push.apply(v,p.effects),t=p.resolve;for(let e of v)`tState`in e&&(e.state=e.tState),delete e.tState;p=null,S(()=>{for(let e of n)C(e);for(let t of e){if(t.value=t.tValue,t.owned)for(let e=0,n=t.owned.length;e<n;e++)C(t.owned[e]);t.tOwned&&(t.owned=t.tOwned),delete t.tValue,delete t.tOwned,t.tState=0}ce(!1)},!1)}else if(p.running){p.running=!1,p.effects.push.apply(p.effects,v),v=null,ce(!0);return}}let n=v;v=null,n.length&&S(()=>c(n),!1),t&&t()}function _e(e){for(let t=0;t<e.length;t++)x(e[t])}function ve(e){for(let t=0;t<e.length;t++){let n=e[t],r=p.queue;r.has(n)||(r.add(n),m(()=>{r.delete(n),S(()=>{p.running=!0,x(n)},!1),p&&(p.running=!1)}))}}function ye(e){let t,r=0;for(t=0;t<e.length;t++){let n=e[t];n.user?e[r++]=n:x(n)}if(n.context){if(n.count){n.effects||=[],n.effects.push(...e.slice(0,r));return}i()}for(n.effects&&(n.done||!n.count)&&(e=[...n.effects,...e],r+=n.effects.length,delete n.effects),t=0;t<r;t++)x(e[t])}function be(e,t){let n=p&&p.running;n?e.tState=0:e.state=0;for(let r=0;r<e.sources.length;r+=1){let i=e.sources[r];if(i.sources){let e=n?i.tState:i.state;e===l?i!==t&&(!i.updatedAt||i.updatedAt<y)&&x(i):e===u&&be(i,t)}}}function xe(e){let t=p&&p.running;for(let n=0;n<e.observers.length;n+=1){let r=e.observers[n];(t?!r.tState:!r.state)&&(t?r.tState=u:r.state=u,r.pure?_.push(r):v.push(r),r.observers&&xe(r))}}function C(e){let t;if(e.sources)for(;e.sources.length;){let t=e.sources.pop(),n=e.sourceSlots.pop(),r=t.observers;if(r&&r.length){let e=r.pop(),i=t.observerSlots.pop();n<r.length&&(e.sourceSlots[i]=n,r[n]=e,t.observerSlots[n]=i)}}if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)C(e.tOwned[t]);delete e.tOwned}if(p&&p.running&&e.pure)Se(e,!0);else if(e.owned){for(t=e.owned.length-1;t>=0;t--)C(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}p&&p.running?e.tState=0:e.state=0}function Se(e,t){if(t||(e.tState=0,p.disposed.add(e)),e.owned)for(let t=0;t<e.owned.length;t++)Se(e.owned[t])}function Ce(e){return e instanceof Error?e:Error(typeof e==`string`?e:`Unknown error`,{cause:e})}function we(e,t,n){try{for(let n of t)n(e)}catch(e){Te(e,n&&n.owner||null)}}function Te(e,t=f){let n=s&&t&&t.context&&t.context[s],r=Ce(e);if(!n)throw r;v?v.push({fn(){we(r,n,t)},state:l}):we(r,n,t)}var Ee=!1;function w(e,t){if(Ee&&n.context){let r=n.context;i(a());let o=b(()=>e(t||{}));return i(r),o}return b(()=>e(t||{}))}function De(e,t,n){let r=n.length,i=t.length,a=r,o=0,s=0,c=t[i-1].nextSibling,l=null;for(;o<i||s<a;){if(t[o]===n[s]){o++,s++;continue}for(;t[i-1]===n[a-1];)i--,a--;if(i===o){let t=a<r?s?n[s-1].nextSibling:n[a-s]:c;for(;s<a;)e.insertBefore(n[s++],t)}else if(a===s)for(;o<i;)(!l||!l.has(t[o]))&&t[o].remove(),o++;else if(t[o]===n[a-1]&&n[s]===t[i-1]){let r=t[--i].nextSibling;e.insertBefore(n[s++],t[o++].nextSibling),e.insertBefore(n[--a],r),t[i]=n[a]}else{if(!l){l=new Map;let e=s;for(;e<a;)l.set(n[e],e++)}let r=l.get(t[o]);if(r!=null)if(s<r&&r<a){let c=o,u=1,d;for(;++c<i&&c<a&&!((d=l.get(t[c]))==null||d!==r+u);)u++;if(u>r-s){let i=t[o];for(;s<r;)e.insertBefore(n[s++],i)}else e.replaceChild(n[s++],t[o++])}else o++;else t[o++].remove()}}}function Oe(e,t,n,r={}){let i;return ee(r=>{i=r,t===document?e():E(t,e(),t.firstChild?null:void 0,n)},r.owner),()=>{i(),t.textContent=``}}function T(e,t,n,r){let i,a=()=>{let t=r?document.createElementNS(`http://www.w3.org/1998/Math/MathML`,`template`):document.createElement(`template`);return t.innerHTML=e,n?t.content.firstChild.firstChild:r?t.firstChild:t.content.firstChild},o=t?()=>b(()=>document.importNode(i||=a(),!0)):()=>(i||=a()).cloneNode(!0);return o.cloneNode=o,o}function ke(e,t,n){return b(()=>e(t,n))}function E(e,t,n,r){if(n!==void 0&&!r&&(r=[]),typeof t!=`function`)return D(e,t,r,n);ne(r=>D(e,t(),r,n),r)}function Ae(e){return!!n.context&&!n.done&&(!e||e.isConnected)}function D(e,t,n,r,i){let a=Ae(e);if(a){!n&&(n=[...e.childNodes]);let t=[];for(let e=0;e<n.length;e++){let r=n[e];r.nodeType===8&&r.data.slice(0,2)===`!$`?r.remove():t.push(r)}n=t}for(;typeof n==`function`;)n=n();if(t===n)return n;let o=typeof t,s=r!==void 0;if(e=s&&n[0]&&n[0].parentNode||e,o===`string`||o===`number`){if(a||o===`number`&&(t=t.toString(),t===n))return n;if(s){let i=n[0];i&&i.nodeType===3?i.data!==t&&(i.data=t):i=document.createTextNode(t),n=O(e,n,r,i)}else n=n!==``&&typeof n==`string`?e.firstChild.data=t:e.textContent=t}else if(t==null||o===`boolean`){if(a)return n;n=O(e,n,r)}else if(o===`function`)return ne(()=>{let i=t();for(;typeof i==`function`;)i=i();n=D(e,i,n,r)}),()=>n;else if(Array.isArray(t)){let o=[],c=n&&Array.isArray(n);if(je(o,t,n,i))return ne(()=>n=D(e,o,n,r,!0)),()=>n;if(a){if(!o.length)return n;if(r===void 0)return n=[...e.childNodes];let t=o[0];if(t.parentNode!==e)return n;let i=[t];for(;(t=t.nextSibling)!==r;)i.push(t);return n=i}if(o.length===0){if(n=O(e,n,r),s)return n}else c?n.length===0?Me(e,o,r):De(e,n,o):(n&&O(e),Me(e,o));n=o}else if(t.nodeType){if(a&&t.parentNode)return n=s?[t]:t;if(Array.isArray(n)){if(s)return n=O(e,n,r,t);O(e,n,null,t)}else n==null||n===``||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);n=t}return n}function je(e,t,n,r){let i=!1;for(let a=0,o=t.length;a<o;a++){let o=t[a],s=n&&n[e.length],c;if(!(o==null||o===!0||o===!1))if((c=typeof o)==`object`&&o.nodeType)e.push(o);else if(Array.isArray(o))i=je(e,o,s)||i;else if(c===`function`)if(r){for(;typeof o==`function`;)o=o();i=je(e,Array.isArray(o)?o:[o],Array.isArray(s)?s:[s])||i}else e.push(o),i=!0;else{let t=String(o);s&&s.nodeType===3&&s.data===t?e.push(s):e.push(document.createTextNode(t))}}return i}function Me(e,t,n=null){for(let r=0,i=t.length;r<i;r++)e.insertBefore(t[r],n)}function O(e,t,n,r){if(n===void 0)return e.textContent=``;let i=r||document.createTextNode(``);if(t.length){let r=!1;for(let a=t.length-1;a>=0;a--){let o=t[a];if(i!==o){let t=o.parentNode===e;!r&&!a?t?e.replaceChild(i,o):e.insertBefore(i,n):t&&o.remove()}else r=!0}}else e.insertBefore(i,n);return[i]}function Ne(e,t,n){let r=1e3/60,i=performance.now(),a=0;function o(s){requestAnimationFrame(o);let c=Math.min(s-i,25);for(i=s,a+=c;a>=r;)e(r),a-=r;t(a/r),n?.()}requestAnimationFrame(o)}function Pe(e,t){let n=e.getBoundingClientRect(),r=e=>[e.clientX,e.clientY],i=e=>{let[t,i]=r(e);return[(t-n.left)/n.width,(i-n.top)/n.height]};function a(n){e.setPointerCapture(n.pointerId),t.on_down(i(n))}function o(n){try{e.releasePointerCapture(n.pointerId)}catch{}t.on_up(i(n))}function s(e){t.on_move(i(e))}function c(){n=e.getBoundingClientRect()}e.addEventListener(`pointerdown`,a),e.addEventListener(`pointermove`,s),document.addEventListener(`pointerup`,o),new ResizeObserver(()=>c()).observe(e),document.addEventListener(`scroll`,c,{passive:!0,capture:!0}),window.addEventListener(`resize`,c,{passive:!0})}function Fe(e){let t=[500,500],n,r,i,a,o=!1,s=0;function c(t){return[t[0]*e.width,t[1]*e.height]}return Pe(e,{on_down(e){e=c(e),r=void 0,n=e,i=e,o=!1},on_up(e){e=c(e),n=void 0,r=e},on_move(e){if(e=c(e),t=e,n){let t=n[0]-e[0],r=n[1]-e[1];t*t+r*r>64&&(o=!0)}}}),{get is_hovering(){return t},get is_down(){return n},get is_up(){return r},get is_just_down(){return i},get is_double_click(){return a},get has_moved_after_last_down(){return o},update(e){a=void 0,i&&s>0&&(a=i,s=0),s-=e,i=void 0,r=void 0}}}var Ie=class e{renderer;static INSTANCE_STRIDE=15;maxInstances;buffer;cursor=0;constructor(t,n=8192){this.renderer=t,this.maxInstances=n,this.buffer=new Float32Array(n*e.INSTANCE_STRIDE)}beginFrame(){this.cursor=0}endFrame(){this.flush()}ensureCapacity(e){if(this.cursor+e>this.maxInstances&&(this.flush(),e>this.maxInstances))throw Error(`Requested instance count exceeds maxInstances`)}pushInstance(t){let n=this.cursor*e.INSTANCE_STRIDE;for(let r=0;r<e.INSTANCE_STRIDE;r++)this.buffer[n+r]=t[r]??0;this.cursor++}fillRect(e,t,n,r,i,a=0){this.ensureCapacity(1),this.pushInstance([e,t,n,r,a,i.r,i.g,i.b,i.a,0,0,0,0,0,0])}fillRoundRect(e,t,n,r,i,a,o=0){this.ensureCapacity(1),this.pushInstance([e,t,n,r,o,a.r,a.g,a.b,a.a,1,i,0,0,0,0])}strokeRoundRect(e,t,n,r,i,a,o,s=[0,0],c=0){this.ensureCapacity(1),this.pushInstance([e,t,n+a,r+a,c,o.r,o.g,o.b,o.a,1,i,a,s[0],s[1],0])}strokeRect(e,t,n,r,i,a,o=[0,0],s=0){this.ensureCapacity(1),this.pushInstance([e,t,n+i,r+i,s,a.r,a.g,a.b,a.a,0,0,i,o[0],o[1],0])}strokeLine(e,t,n,r,i,a,o=[0,0]){this.ensureCapacity(1);let s=n-e,c=r-t,l=Math.hypot(s,c),u=Math.atan2(c,s),d=l+i+8,f=i+8,p=(e+n)*.5,m=(t+r)*.5,h=i*.5;this.pushInstance([p,m,d,f,u,a.r,a.g,a.b,a.a,2,h,0,o[0],o[1],l])}flush(){if(this.cursor===0)return;let t=this.cursor*e.INSTANCE_STRIDE,n=this.buffer.subarray(0,t);this.renderer.instanceData.length>=t?this.renderer.instanceData.set(n,0):this.renderer.instanceData=new Float32Array(n),this.renderer.instanceCount=this.cursor,this.renderer.flush(),this.cursor=0}},Le=`#version 300 es
precision highp float;

layout(location = 0) in vec2 a_pos;            
layout(location = 1) in vec2 a_translation;    
layout(location = 2) in vec2 a_size;           
layout(location = 3) in float a_rotation;      
layout(location = 4) in vec4 a_color;          
layout(location = 5) in float a_type;          
layout(location = 6) in float a_radius;        
layout(location = 7) in float a_stroke;        
layout(location = 8) in vec2 a_dash;           
layout(location = 9) in float a_length;        

out vec2 v_local;
out vec2 v_size;
out vec4 v_color;
out float v_type;
out float v_radius;
out float v_stroke;
out vec2 v_dash;
out float v_length;

uniform vec2 u_resolution; 

void main() {
    
    vec2 local = (a_pos - 0.5) * a_size;
    v_local = local;
    v_size = a_size;

    
    v_color = a_color;
    v_type = a_type;
    v_radius = a_radius;
    v_stroke = a_stroke;
    v_dash = a_dash;
    v_length = a_length;

    
    float s = sin(a_rotation);
    float c = cos(a_rotation);
    vec2 rotated = vec2(
        local.x * c - local.y * s,
        local.x * s + local.y * c
    );

    
    vec2 world = rotated + a_translation;

    
    vec2 ndc = (world / u_resolution) * 2.0 - 1.0;
    gl_Position = vec4(ndc * vec2(1, -1), 0.0, 1.0);
}`,Re=`#version 300 es
precision highp float;

in vec2 v_local;
in vec2 v_size;
in vec4 v_color;
in float v_type;
in float v_radius;
in float v_stroke;
in vec2 v_dash;
in float v_length;

out vec4 fragColor;

float sdRect(vec2 p, vec2 b) {
    vec2 d = abs(p) - b;
    return max(d.x, d.y);
}

float sdRoundRect(vec2 p, vec2 b, float r) {
    vec2 d = abs(p) - b + vec2(r);
    return length(max(d, 0.0)) - r;
}

float sdCapsule(vec2 p, float len, float r) {
    
    vec2 a = vec2(-len * 0.5, 0.0);
    vec2 b = vec2( len * 0.5, 0.0);
    vec2 pa = p - a;
    vec2 ba = b - a;
    float h = clamp(dot(pa, ba) / dot(ba, ba), 0.0, 1.0);
    return length(pa - ba * h) - r;
}

float applyDash(float distAlongLine, float dash, float gap) {
    float total = dash + gap;
    float m = mod(distAlongLine, total);
    return (m < dash) ? 1.0 : 0.0;
}

void main() {

    
    vec2 p = v_local;

    float d = 0.0;

    
    
    
    if (v_type == 0.0) {
        d = sdRect(p, v_size * 0.5);
    }

    
    
    
    if (v_type == 1.0) {
        d = sdRoundRect(p, v_size * 0.5 - vec2(v_radius), v_radius);
    }

    
    
    
    if (v_type == 2.0) {
        
        d = sdCapsule(p, v_length, v_radius);
    }

    
    
    
    float alpha = 0.0;

    if (v_stroke == 0.0) {
        
        float edge = fwidth(d);
        alpha = 1.0 - smoothstep(0.0, edge, d);

    } else {
        
        float halfStroke = v_stroke * 0.5;
        float distToStroke = abs(d) - halfStroke;
        float edge = fwidth(distToStroke);
        alpha = 1.0 - smoothstep(0.0, edge, distToStroke);

        
        
        
        if (v_dash.x > 0.0) {
            
            
            float distAxis = (v_type == 2.0)
                ? (p.x + v_length * 0.5)
                : abs(p.x) + abs(p.y);

            float dashMask = applyDash(distAxis, v_dash.x, v_dash.y);
            alpha *= dashMask;
        }
    }

    fragColor = vec4(v_color.rgb, v_color.a * alpha);
}`,ze=class{gl;program;vao;quadVBO;instanceVBO;maxInstances;instanceStride;instanceData;instanceCount=0;uResolution;constructor(e,t=1e4){let n=e.getContext(`webgl2`,{antialias:!0});if(!n)throw Error(`WebGL2 not supported`);this.gl=n,this.maxInstances=t,this.quadVBO=n.createBuffer(),this.instanceVBO=n.createBuffer(),this.program=this.createProgram(Le,Re),this.uResolution=n.getUniformLocation(this.program,`u_resolution`),this.instanceStride=15,this.instanceData=new Float32Array(this.maxInstances*this.instanceStride),this.vao=this.createVAO(),n.enable(n.BLEND),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA)}createVAO(){let e=this.gl,t=e.createVertexArray();e.bindVertexArray(t);let n=new Float32Array([0,0,1,0,0,1,1,1]);return e.bindBuffer(e.ARRAY_BUFFER,this.quadVBO),e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW),e.enableVertexAttribArray(0),e.vertexAttribPointer(0,2,e.FLOAT,!1,8,0),e.vertexAttribDivisor(0,0),e.bindBuffer(e.ARRAY_BUFFER,this.instanceVBO),e.bufferData(e.ARRAY_BUFFER,this.instanceData.byteLength,e.DYNAMIC_DRAW),t}setupInstancing(){let e=this.gl;e.bindVertexArray(this.vao),e.bindBuffer(e.ARRAY_BUFFER,this.instanceVBO);let t=this.instanceStride*4,n=0,r=1,i=i=>{e.enableVertexAttribArray(r),e.vertexAttribPointer(r,i,e.FLOAT,!1,t,n),e.vertexAttribDivisor(r,1),n+=i*4,r++};i(2),i(2),i(1),i(4),i(1),i(1),i(1),i(2),i(1)}addInstance(e){let t=this.instanceCount*this.instanceStride;this.instanceData.set(e,t),this.instanceCount++,this.instanceCount>=this.maxInstances&&console.warn(`Instance buffer full`)}flush(){let e=this.gl;this.instanceCount!==0&&(e.useProgram(this.program),e.bindVertexArray(this.vao),e.uniform2f(this.uResolution,e.canvas.width,e.canvas.height),e.bindBuffer(e.ARRAY_BUFFER,this.instanceVBO),e.bufferSubData(e.ARRAY_BUFFER,0,this.instanceData.subarray(0,this.instanceCount*this.instanceStride)),e.drawArraysInstanced(e.TRIANGLE_STRIP,0,4,this.instanceCount),this.instanceCount=0)}createProgram(e,t){let n=this.gl,r=n.createShader(n.VERTEX_SHADER);if(n.shaderSource(r,e),n.compileShader(r),!n.getShaderParameter(r,n.COMPILE_STATUS))throw Error(n.getShaderInfoLog(r));let i=n.createShader(n.FRAGMENT_SHADER);if(n.shaderSource(i,t),n.compileShader(i),!n.getShaderParameter(i,n.COMPILE_STATUS))throw Error(n.getShaderInfoLog(i));let a=n.createProgram();if(n.attachShader(a,r),n.attachShader(a,i),n.linkProgram(a),!n.getProgramParameter(a,n.LINK_STATUS))throw Error(n.getProgramInfoLog(a));return n.deleteShader(r),n.deleteShader(i),a}};let k,A;function Be(){let e=document.createElement(`canvas`);e.width=1080,e.height=1080;let t=new ze(e,32768);return t.setupInstancing(),A=new Ie(t,16384),k=Fe(e),e}function j(e=0,t=0){return{x:e,y:t}}function Ve(e,t){return{x:e.x+t.x,y:e.y+t.y}}function He(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Ue(e,t){return{x:e.x*t,y:e.y*t}}var We={duration:.2,easing:e=>e},Ge={stiffness:150,damping:18},Ke={speed:1},qe={amplitude:0,frequency:3,bias:0},M=class{value;velocity=0;baseValue=0;mode=`hold`;time=0;timeInMode=0;tweenStart=0;tweenTarget=0;tweenConfig=We;springTarget=0;springConfig=Ge;followTarget=0;followConfig=Ke;swayEnabled=!1;swayConfig={...qe};lastSwayValue=0;swayFade=0;constructor(e=0){this.baseValue=e,this.value=this.baseValue}hold(){return this.mode=`hold`,this.timeInMode=0,this.velocity=0,this}tweenTo(e,t){return this.mode=`tween`,this.tweenConfig={...We,...t},this.tweenStart=this.value,this.tweenTarget=e,this.timeInMode=0,this}springTo(e,t){return this.mode=`spring`,this.springConfig={...Ge,...t},this.springTarget=e,this.timeInMode=0,this}followTo(e,t){return this.mode=`follow`,this.followConfig={...Ke,...t},this.followTarget=e,this}swayTo(e){return this.swayConfig={...this.swayConfig,...e},this.swayEnabled=!0,this}disableSway(){return this.swayEnabled=!1,this}update(e){switch(this.time+=e,this.timeInMode+=e,this.mode){case`hold`:break;case`tween`:{let e=Math.min(this.timeInMode/this.tweenConfig.duration,1),t=this.tweenConfig.easing(e);this.baseValue=this.tweenStart+(this.tweenTarget-this.tweenStart)*t;break}case`spring`:{let{stiffness:t,damping:n}=this.springConfig,r=-t*(this.baseValue-this.springTarget)-n*this.velocity;this.velocity+=r*e,this.baseValue+=this.velocity*e;break}case`follow`:{let{speed:t}=this.followConfig,n=1-(1-t)**e;this.baseValue+=(this.followTarget-this.baseValue)*n;break}}if(this.swayEnabled&&this.swayConfig){this.swayFade=Math.min(this.swayFade+e*8,1);let t=(Math.sin(this.time*this.swayConfig.frequency+0)*this.swayConfig.amplitude+this.swayConfig.bias-this.lastSwayValue)*this.swayFade;this.baseValue+=t,this.lastSwayValue+=t}else this.swayFade=0;this.value=this.baseValue}},Je=class e{r;g;b;a;constructor(e,t,n,r){this.r=e,this.g=t,this.b=n,this.a=r}static fromRgba255(t,n,r,i=255){return new e(t/255,n/255,r/255,i/255)}static fromHex(t){return e.fromRgba255((t&16711680)>>16,(t&65280)>>8,t&255,255)}static fromHexString(t){let n=t.startsWith(`#`)?t.slice(1):t;n=n.startsWith(`0x`)?n.slice(2):n,n.length===3&&(n=n.split(``).map(e=>e+e).join(``));let r=parseInt(n,16);return isNaN(r)?(console.error(`Invalid color hex string: ${t}`),null):n.length===6?e.fromRgba255(r>>16&255,r>>8&255,r&255,255):n.length===8?e.fromRgba255(r>>24&255,r>>16&255,r>>8&255,r&255):(console.error(`Unsupported hex string length: ${t}`),null)}static white=e.fromRgba255(255,255,255,255);static black=e.fromRgba255(0,0,0,255);static red=e.fromRgba255(255,0,0,255);static lerp(t,n,r){return r=Math.max(0,Math.min(1,r)),new e(t.r+(n.r-t.r)*r,t.g+(n.g-t.g)*r,t.b+(n.b-t.b)*r,t.a+(n.a-t.a)*r)}get rgb24(){let e=Math.round(this.r*255),t=Math.round(this.g*255),n=Math.round(this.b*255);return e<<16|t<<8|n}get rgbaNormalized(){return{r:this.r,g:this.g,b:this.b,a:this.a}}get rgba255(){return{r:Math.round(this.r*255),g:Math.round(this.g*255),b:Math.round(this.b*255),a:Math.round(this.a*255)}}};const Ye={black:`#000000`,darkblue:`#1D2B53`,darkred:`#7E2553`,darkgreen:`#008751`,brown:`#AB5236`,gray:`#5F574F`,lightgray:`#C2C3C7`,white:`#FFF1E8`,red:`#FF004D`,orange:`#FFA300`,yellow:`#FFEC27`,green:`#00E436`,blue:`#29ADFF`,purple:`#83769C`,pink:`#FF77A8`,sand:`#FFCCAA`},Xe={white:`#fbf8fd`,light:`#a1a9d1`,blue:`#007fff`,darkblue:`#24256f`,black:`#141218`,purple:`#5f0e52`,red:`#fd1a43`,pink:`#ffb16c`,yellow:`#fede5b`,green:`#74ead6`},N={};for(let e of Object.keys(Ye))N[e]=Je.fromHexString(Ye[e]);const P={};for(let e of Object.keys(Xe))P[e]=Je.fromHexString(Xe[e]);const F=e=>e>>3,I=e=>e&7,Ze=(e,t)=>0<=e&&e<8&&0<=t&&t<8?e+8*t:void 0;var Qe=e=>(e-=e>>>1&1431655765,e=(e&858993459)+(e>>>2&858993459),Math.imul(e+(e>>>4)&252645135,16843009)>>24),$e=e=>(e=e>>>8&16711935|(e&16711935)<<8,e>>>16&65535|(e&65535)<<16),et=e=>(e=e>>>1&1431655765|(e&1431655765)<<1,e=e>>>2&858993459|(e&858993459)<<2,e=e>>>4&252645135|(e&252645135)<<4,$e(e)),L=class e{lo;hi;constructor(e,t){this.lo=e|0,this.hi=t|0}static fromSquare(t){return t>=32?new e(0,1<<t-32):new e(1<<t,0)}static fromRank(t){return new e(255,0).shl64(8*t)}static fromFile(t){return new e(16843009<<t,16843009<<t)}static empty(){return new e(0,0)}static full(){return new e(4294967295,4294967295)}static corners(){return new e(129,2164260864)}static center(){return new e(402653184,24)}static backranks(){return new e(255,4278190080)}static backrank(t){return t===`white`?new e(255,0):new e(0,4278190080)}static lightSquares(){return new e(1437226410,1437226410)}static darkSquares(){return new e(2857740885,2857740885)}complement(){return new e(~this.lo,~this.hi)}xor(t){return new e(this.lo^t.lo,this.hi^t.hi)}union(t){return new e(this.lo|t.lo,this.hi|t.hi)}intersect(t){return new e(this.lo&t.lo,this.hi&t.hi)}diff(t){return new e(this.lo&~t.lo,this.hi&~t.hi)}intersects(e){return this.intersect(e).nonEmpty()}isDisjoint(e){return this.intersect(e).isEmpty()}supersetOf(e){return e.diff(this).isEmpty()}subsetOf(e){return this.diff(e).isEmpty()}shr64(t){return t>=64?e.empty():t>=32?new e(this.hi>>>t-32,0):t>0?new e(this.lo>>>t^this.hi<<32-t,this.hi>>>t):this}shl64(t){return t>=64?e.empty():t>=32?new e(0,this.lo<<t-32):t>0?new e(this.lo<<t,this.hi<<t^this.lo>>>32-t):this}bswap64(){return new e($e(this.hi),$e(this.lo))}rbit64(){return new e(et(this.hi),et(this.lo))}minus64(t){let n=this.lo-t.lo,r=(n&t.lo&1)+(t.lo>>>1)+(n>>>1)>>>31;return new e(n,this.hi-(t.hi+r))}equals(e){return this.lo===e.lo&&this.hi===e.hi}size(){return Qe(this.lo)+Qe(this.hi)}isEmpty(){return this.lo===0&&this.hi===0}nonEmpty(){return this.lo!==0||this.hi!==0}has(e){return(e>=32?this.hi&1<<e-32:this.lo&1<<e)!=0}set(e,t){return t?this.with(e):this.without(e)}with(t){return t>=32?new e(this.lo,this.hi|1<<t-32):new e(this.lo|1<<t,this.hi)}without(t){return t>=32?new e(this.lo,this.hi&~(1<<t-32)):new e(this.lo&~(1<<t),this.hi)}toggle(t){return t>=32?new e(this.lo,this.hi^1<<t-32):new e(this.lo^1<<t,this.hi)}last(){if(this.hi!==0)return 63-Math.clz32(this.hi);if(this.lo!==0)return 31-Math.clz32(this.lo)}first(){if(this.lo!==0)return 31-Math.clz32(this.lo&-this.lo);if(this.hi!==0)return 63-Math.clz32(this.hi&-this.hi)}withoutFirst(){return this.lo===0?new e(0,this.hi&this.hi-1):new e(this.lo&this.lo-1,this.hi)}moreThanOne(){return this.hi!==0&&this.lo!==0||(this.lo&this.lo-1)!=0||(this.hi&this.hi-1)!=0}singleSquare(){return this.moreThanOne()?void 0:this.last()}*[Symbol.iterator](){let e=this.lo,t=this.hi;for(;e!==0;){let t=31-Math.clz32(e&-e);e^=1<<t,yield t}for(;t!==0;){let e=31-Math.clz32(t&-t);t^=1<<e,yield 32+e}}*reversed(){let e=this.lo,t=this.hi;for(;t!==0;){let e=31-Math.clz32(t);t^=1<<e,yield 32+e}for(;e!==0;){let t=31-Math.clz32(e);e^=1<<t,yield t}}},tt=(e,t)=>{let n=L.empty();for(let r of t){let t=e+r;0<=t&&t<64&&Math.abs(I(e)-I(t))<=2&&(n=n.with(t))}return n},R=e=>{let t=[];for(let n=0;n<64;n++)t[n]=e(n);return t},nt=R(e=>tt(e,[-9,-8,-7,-1,1,7,8,9])),rt=R(e=>tt(e,[-17,-15,-10,-6,6,10,15,17])),it={white:R(e=>tt(e,[7,9])),black:R(e=>tt(e,[-7,-9]))};const at=e=>nt[e],ot=e=>rt[e],st=(e,t)=>it[e][t];var ct=R(e=>L.fromFile(I(e)).without(e)),lt=R(e=>L.fromRank(F(e)).without(e)),ut=R(e=>{let t=new L(134480385,2151686160),n=8*(F(e)-I(e));return(n>=0?t.shl64(n):t.shr64(-n)).without(e)}),dt=R(e=>{let t=new L(270549120,16909320),n=8*(F(e)+I(e)-7);return(n>=0?t.shl64(n):t.shr64(-n)).without(e)}),ft=(e,t,n)=>{let r=n.intersect(t),i=r.bswap64();return r=r.minus64(e),i=i.minus64(e.bswap64()),r.xor(i.bswap64()).intersect(t)},pt=(e,t)=>ft(L.fromSquare(e),ct[e],t),mt=(e,t)=>{let n=lt[e],r=t.intersect(n),i=r.rbit64();return r=r.minus64(L.fromSquare(e)),i=i.minus64(L.fromSquare(63-e)),r.xor(i.rbit64()).intersect(n)};const ht=(e,t)=>{let n=L.fromSquare(e);return ft(n,ut[e],t).xor(ft(n,dt[e],t))},gt=(e,t)=>pt(e,t).xor(mt(e,t)),_t=(e,t)=>ht(e,t).xor(gt(e,t)),vt=(e,t,n)=>{switch(e.role){case`pawn`:return st(e.color,t);case`knight`:return ot(t);case`bishop`:return ht(t,n);case`rook`:return gt(t,n);case`queen`:return _t(t,n);case`king`:return at(t)}};function yt(e,t){let{x:n,y:r}=e,i=t.get(n),a=t.get(r);if(I(i)===I(a))return i<a?3:7;if(F(i)===F(a))return i<a?1:5;let o=I(i)-I(a),s=F(i)-F(a);if(Math.abs(o)===Math.abs(s))return o<0?s<0?2:8:s<0?4:6;if(o===2){if(s===1)return 11;if(s===-1)return 12}else if(o===-2){if(s===1)return 13;if(s===-1)return 14}else if(o===1){if(s===2)return 15;if(s===-2)return 16}else if(o===-1){if(s===2)return 17;if(s===-2)return 18}return 0}function bt(e){let t=xt(e),n=[];for(let[r,i]of e.entries()){let a=vt(St(r),i,t);a=a.intersect(t);for(let t of a){let[i]=[...e.entries()].find(e=>e[1]===t);n.push({x:r,y:i})}}return n}function xt(e){let t=L.empty();for(let n of e.values())t=t.set(n,!0);return t}function St(e){switch(e[0]){case`P`:return{color:`white`,role:`pawn`};case`p`:return{color:`black`,role:`pawn`};case`b`:return{color:`black`,role:`bishop`};case`n`:return{color:`black`,role:`knight`};case`r`:return{color:`black`,role:`rook`};case`q`:return{color:`black`,role:`queen`};case`k`:return{color:`black`,role:`king`}}}function Ct(e){e=e.split(` `)[0];let t=new Map,n=0,r=0,i=0,a=0,o=0,s=0,c=0,l=e=>{switch(e){case`P`:return`P`+ ++n;case`p`:return`p`+ ++r;case`B`:case`b`:return`b`+ ++a;case`N`:case`n`:return`n`+ ++s;case`R`:case`r`:return`r`+ ++o;case`Q`:case`q`:return`q`+ ++c;case`K`:case`k`:return`k`+ ++i}},u=7;for(let n of e.split(`/`)){let e=0;for(let r of n){let n=l(r);if(n!==void 0){let r=Ze(e,u);r!==void 0&&t.set(n,r),e+=1}else{e+=parseInt(r);continue}}--u}return t}var z=120,B=class e{static createEmptyGrid(){return Array(8).fill(null).map(()=>Array(8).fill(!1))}static checkerboard2(){let t=e.createEmptyGrid();for(let e=0;e<8;e++)for(let n=0;n<8;n++)t[e][n]=(e+n)%2==1;return t}static checkerboard(){let t=e.createEmptyGrid();for(let e=0;e<8;e++)for(let n=0;n<8;n++)t[e][n]=(e+n)%2==0;return t}static fullGrid(){let t=e.createEmptyGrid();for(let e=0;e<8;e++)for(let n=0;n<8;n++)t[e][n]=!0;return t}static border(){let t=e.createEmptyGrid();for(let e=0;e<8;e++)for(let n=0;n<8;n++)t[e][n]=e===0||e===7||n===0||n===7;return t}static diagonal(){let t=e.createEmptyGrid();for(let e=0;e<8;e++)for(let n=0;n<8;n++)t[e][n]=e===n||e===7-n;return t}static cross(){let t=e.createEmptyGrid();for(let e=0;e<8;e++)for(let n=0;n<8;n++)t[e][n]=e===3||e===4||n===3||n===4;return t}static dots(){let t=e.createEmptyGrid();for(let e=0;e<8;e++)for(let n=0;n<8;n++)t[e][n]=e%2==0&&n%2==0;return t}static fromString(t){let n=e.createEmptyGrid(),r=t.trim().split(`
`);for(let e=0;e<8&&e<r.length;e++){let t=r[e].split(``);for(let r=0;r<8&&r<t.length;r++)n[e][r]=t[r]===`1`||t[r]===`X`}return n}static random(){let t=e.createEmptyGrid();for(let e=0;e<8;e++)for(let n=0;n<8;n++)t[e][n]=Math.random()>.5;return t}},V=class{static patternTransition(e,t,n=10){let r=[],i=e.length,a=e[0].length;for(let o=0;o<=n;o++){let s=o/n,c=B.createEmptyGrid();for(let n=0;n<i;n++)for(let r=0;r<a;r++){let i=e[n][r]?1:0,a=t[n][r]?1:0,o=i*(1-s)+a*s;c[n][r]=o>.5}r.push({grid:c,delay:z})}return r}static rowSweep(e,t=`top`){let n=[];for(let r=0;r<8;r++){let i=B.createEmptyGrid(),a=t===`top`?r:7-r;for(let n=0;n<8;n++)for(let r=0;r<8;r++)i[n][r]=e[n][r]&&(t===`top`&&n<=a||t===`bottom`&&n>=a);n.push({grid:i,delay:z})}return n}static columnSweep(e,t=`left`){let n=[];for(let r=0;r<8;r++){let i=B.createEmptyGrid(),a=t===`left`?r:7-r;for(let n=0;n<8;n++)for(let r=0;r<8;r++)i[n][r]=e[n][r]&&(t===`left`&&r<=a||t===`right`&&r>=a);n.push({grid:i,delay:z})}return n}static randomBlink(e,t=20){let n=[];for(let r=0;r<t;r++){let t=B.createEmptyGrid();for(let n=0;n<8;n++)for(let r=0;r<8;r++)t[n][r]=e[n][r]&&Math.random()>.3;n.push({grid:t,delay:z})}return n}static pulse(e,t=3){let n=[],r=e.length,i=e[0].length;for(let a=0;a<t;a++)for(let t=0;t<10;t++){let a=t/9,o=Math.sin(a*Math.PI),s=B.createEmptyGrid();for(let t=0;t<r;t++)for(let n=0;n<i;n++)s[t][n]=e[t][n]&&o>.5;n.push({grid:s,delay:z})}return n}static wave(e,t=`horizontal`){let n=[],r=e.length,i=e[0].length;for(let a=0;a<16;a++){let o=B.createEmptyGrid();for(let n=0;n<r;n++)for(let r=0;r<i;r++){let i=t===`horizontal`?n:r,s=(Math.sin((i+a*.5)*Math.PI/4)+1)*.5;o[n][r]=e[n][r]&&s>.5}n.push({grid:o,delay:z})}return n}};const H={empty:B.createEmptyGrid,checkerboard:B.checkerboard,checkerboard2:B.checkerboard2,full:B.fullGrid,border:B.border,diagonal:B.diagonal,cross:B.cross,dots:B.dots,random:B.random},wt={rowsweep:e=>V.rowSweep(e,`top`),"rowsweep-reverse":e=>V.rowSweep(e,`bottom`),colsweep:e=>V.columnSweep(e,`left`),"colsweep-reverse":e=>V.columnSweep(e,`right`),blink:e=>V.randomBlink(e,20),pulse:e=>V.pulse(e,3),"wave-horizontal":e=>V.wave(e,`horizontal`),"wave-vertical":e=>V.wave(e,`vertical`)},Tt=()=>V.patternTransition(H.checkerboard(),H.checkerboard2(),8),Et=()=>{let e=Object.keys(wt),t=wt[e[Math.floor(Math.random()*e.length)]],n=Object.keys(H);return t(H[n[Math.floor(Math.random()*n.length)]]())};var Dt=t({_init:()=>jt,_render:()=>Rt,_update:()=>Mt,hitbox_rect:()=>qt,next_scene:()=>Yt}),U={xy:j(60,60),wh:j(960,960)};Zt(U);var W,Ot,G,K,q,J;function kt(e){let t=()=>Math.floor(Math.random()*64);K=[];let n=[];for(let r of e.keys()){let e=t();for(;n.includes(e);)e=t();n.push(e),K.push({pieces:r,xy:{x:new M(500),y:new M(500)},sq_base:e})}G=bt(e),q=G.map(e=>({data:e,piece:K.find(t=>t.pieces===e.x),xy:{x:new M(0),y:new M(0)},stick:0})),J=[]}var Y,At,X={x:new M,y:new M,r:new M},Z;function jt(){Z={frames:[],time:0},kt(Ct(`4k3/4b3/5pp1/3KP2p/1p5P/4B1P1/1P6/8 w - - 1 44`)),kt(Ct(`4rk2/3q1p2/2pp1Ppp/p1p5/2P2bN1/1P2Q3/P4PPP/4RK2 w - - 2 28`)),Y=0,At=!1,Ot=0,W={xy:j(0,0),wh:{x:40,y:40},follow:{x:new M(500).swayTo({amplitude:-8,frequency:13,bias:0}),y:new M(500).swayTo({amplitude:-8,frequency:13,bias:0})}}}function Mt(e){Ft(e),Ot+=e/1e3,W.follow.x.followTo(k.is_hovering[0],{speed:.99999999}),W.follow.y.followTo(k.is_hovering[1],{speed:.99999999}),W.follow.x.update(e/1e3),W.follow.y.update(e/1e3),W.xy=j(W.follow.x.value,W.follow.y.value),W.drag&&k.has_moved_after_last_down&&(W.drag.piece.xy.x.followTo(W.xy.x-W.drag.decay.x),W.drag.piece.xy.y.followTo(W.xy.y-W.drag.decay.y)),W.sq=$t(W.xy);let t=!At&&Y===0;if(t&&k.is_just_down){let e=W.sq;if(e!==void 0){let t=K.find(t=>t.sq===e);t&&(t.xy.x.springTo(t.xy.x.value-10,{stiffness:800,damping:10}),t.xy.y.springTo(t.xy.y.value-15,{stiffness:800,damping:10}),W.drag={decay:He(W.xy,{x:t.xy.x.value-10,y:t.xy.y.value-15}),piece:t},W.follow.x.swayEnabled=!1,W.follow.y.swayEnabled=!1)}}k.is_up&&(W.follow.x.swayEnabled=!0,W.follow.y.swayEnabled=!0);for(let t of K)It(t,e);for(let t of q)Lt(t,q.filter(e=>e.stick===0).indexOf(t),e);for(let t of J)Lt(t,0,e);if(k.is_up&&(W.drag&&=void 0,t)){let e=bt(en());G.every(t=>e.some(e=>t.x===e.x&&t.y===e.y))&&e.every(e=>G.some(t=>e.x===t.x&&e.y===t.y))&&(Y=2e3)}Y>0&&(Y-=e,Y<=0&&(Y=0,At=!0,Nt())),Y>1500?(X.x.springTo(10,{stiffness:1e3,damping:8}),X.y.springTo(-35,{stiffness:1e3,damping:8}),X.r.springTo(Math.PI*.5,{stiffness:1e3,damping:2})):Y>800&&X.y.springTo(-1e3,{stiffness:50}),X.x.update(e/1e3),X.y.update(e/1e3),X.r.update(e/1e3),Pt(e)}function Nt(){Z.frames=[...wt.blink(H.full()),...Et(),...Et(),...Et(),...Tt(),...wt.pulse(H.full())]}function Pt(e){let t=Z.frames.shift();t&&(Z.time+=e,Z.time>t.delay?Z.time-=t.delay:Z.frames.unshift(t))}function Ft(e){let t=en(),n=bt(t),r=q;r.forEach(e=>e.stick=0);for(let e of n){let n=r.find(t=>t.data.x===e.x&&t.data.y===e.y);n&&(n.stick=yt(e,t))}let i=n.filter(e=>!G.find(t=>t.x===e.x&&t.y===e.y)),a=J;for(let e of i){let n=a.find(t=>t.data.x===e.x&&t.data.y===e.y),r=yt(e,t);n&&(n.stick=r),n||a.push({data:e,piece:K.find(t=>t.pieces===e.x),xy:{x:new M(0),y:new M(0)},stick:yt(e,t)})}let o=a.filter(e=>!i.find(t=>t.x===e.data.x&&t.y===e.data.y));J=a.filter(e=>!o.includes(e))}function It(e,t){e.sq=$t(j(e.xy.x.value,e.xy.y.value));let n=Qt(e.sq_base);W.drag?.piece===e?k.is_up&&e.sq!==void 0&&(e.sq_base=e.sq):(e.xy.x.springTo(n.x,{stiffness:600,damping:17}),e.xy.y.springTo(n.y,{stiffness:600,damping:17})),e.xy.x.update(t/1e3),e.xy.y.update(t/1e3)}function Lt(e,t,n){if(e.stick===0){let n=Math.sin(Ot*.5*Math.PI*2+t*Math.PI*.25)*80,r=Math.cos(Ot*.5*Math.PI*2+t*Math.PI*.25)*80;e.xy.x.followTo(r,{speed:.999}),e.xy.y.followTo(n,{speed:.999})}else{let[t,n]=Xt[e.stick];e.xy.x.springTo(t*37),e.xy.y.springTo(n*37)}e.xy.x.update(n/1e3),e.xy.y.update(n/1e3)}function Rt(){A.beginFrame(),A.fillRect(1080/2,1080/2,1080,1080,N.darkblue),Gt();for(let e of K)zt(e);Kt(W.xy.x,W.xy.y),A.endFrame()}function zt(e){let t=e.xy.x.value,n=e.xy.y.value;Wt(t,n,e.pieces);for(let e=0;e<q.length;e++){let t=q[e],n=t.piece.xy.x.value,r=t.piece.xy.y.value;n+=t.xy.x.value,r+=t.xy.y.value,n+=X.x.value*(e%2==0?-20:20),r+=X.y.value;let i=X.r.value*(e%2==0?-1:1);Vt(n,r,t.data.y,t.stick,i)}for(let e of J){let t=e.piece.xy.x.value,n=e.piece.xy.y.value;t+=e.xy.x.value,n+=e.xy.y.value,Bt(t,n,e.data.y,e.stick)}}function Bt(e,t,n,r){let i=N.red;A.fillRoundRect(e,t,46,46,6,N.darkblue),A.strokeRoundRect(e,t,46,46,6,1,i),Ut(e,t,n)}function Vt(e,t,n,r,i){let a=r===0?N.red:N.green;A.fillRoundRect(e,t,46,46,6,N.darkblue,i),A.strokeRoundRect(e,t,46,46,6,1,a,void 0,i),Ut(e,t,n)}var Ht=[P.yellow,P.white,P.blue,P.pink,P.green,P.light,P.black,P.purple,P.darkblue];function Ut(e,t,n){let r=Ht[parseInt(n[1])-1];n[0]===`r`&&(A.strokeLine(e-10,t,e+10,t,4,r),A.strokeLine(e,t-10,e,t+10,4,r)),n[0]===`b`&&(A.strokeLine(e-8,t-8,e+8,t+8,4,r),A.strokeLine(e-8,t+8,e+8,t-8,4,r)),n[0]===`P`&&(A.strokeLine(e-8,t-8,e,t,4,r),A.strokeLine(e+8,t-8,e,t,4,r),A.strokeLine(e,t,e,t+4,4,r)),n[0]===`p`&&(A.strokeLine(e-8,t+8,e,t,4,r),A.strokeLine(e+8,t+8,e,t,4,r),A.strokeLine(e,t,e,t-4,4,r)),n[0]===`k`&&A.strokeRoundRect(e,t,20,20,4,4,r),n[0]===`n`&&(A.strokeLine(e-4,t-8,e-4,t+8,4,r),A.strokeLine(e-4,t+8,e+4,t+8,4,r)),n[0]===`q`&&(A.strokeLine(e-10,t,e+10,t,4,r),A.strokeLine(e,t-10,e,t+10,4,r),A.strokeLine(e-8,t-8,e+8,t+8,4,r),A.strokeLine(e-8,t+8,e+8,t-8,4,r))}function Wt(e,t,n){let r=Ht[parseInt(n[1])-1];n[0]===`b`&&(A.strokeLine(e-20,t-20,e+20,t+20,9,r),A.strokeLine(e-20,t+20,e+20,t-20,9,r)),n[0]===`r`&&(A.strokeLine(e-25,t,e+25,t,9,r),A.strokeLine(e,t-25,e,t+25,9,r)),n[0]===`P`&&(A.strokeLine(e-20,t-20,e,t,9,r),A.strokeLine(e+20,t-20,e,t,9,r),A.strokeLine(e,t,e,t+10,9,r)),n[0]===`p`&&(A.strokeLine(e-20,t+20,e,t,9,r),A.strokeLine(e+20,t+20,e,t,9,r),A.strokeLine(e,t,e,t-10,9,r)),n[0]===`k`&&A.strokeRoundRect(e,t,64,64,10,9,r),n[0]===`n`&&(A.strokeLine(e-10,t-20,e-10,t+20,9,r),A.strokeLine(e-10,t+20,e+10,t+20,9,r)),n[0]===`q`&&(A.strokeLine(e-20,t-20,e+20,t+20,9,r),A.strokeLine(e-20,t+20,e+20,t-20,9,r),A.strokeLine(e-22,t,e+22,t,9,r),A.strokeLine(e,t-22,e,t+22,9,r))}function Gt(){let e,t;e=60,t=60;for(let n=0;n<8;n++)for(let r=0;r<8;r++)Z.frames[0]?.grid[n][r]&&((n+r)%2==0?A.fillRoundRect(e+n*120+120/2,t+r*120+120/2,136,136,16,N.pink):A.fillRoundRect(e+n*120+120/2,t+r*120+120/2,152,152,16,N.blue)),(n+r)%2==0?A.strokeRoundRect(e+n*120+120/2,t+r*120+120/2,136,136,16,3,N.pink):A.strokeRoundRect(e+n*120+120/2,t+r*120+120/2,152,152,16,3,N.blue)}function Kt(e,t){A.strokeLine(e+40,t+3,e,t,16,N.black),A.strokeLine(e,t,e+3,t+40,16,N.black)}function qt(e){let t=e.xy.x,n=e.xy.y,r=e.wh.x,i=e.wh.y;A.strokeRect(t+r/2,n+i/2,r,i,7,N.red)}var Jt=void 0;function Yt(){let e=Jt;if(e!==void 0)return Jt=void 0,e}var Xt=[[0,0],[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[-1,1],[0,1],[1,1],[0,0],[0,0],[-1,.6],[-1,-.6],[1,.6],[1,-.6],[-.6,1],[-.6,-1],[.6,1],[.6,-1]];function Zt(e){let t=[];for(let n=0;n<8;n++){let r=[];for(let t=0;t<8;t++)r.push({xy:j(e.xy.x+n*120,e.xy.y+t*120),wh:j(120,120)});t.push(r)}return t}function Qt(e){let t=I(e),n=7-F(e);return Ve(Ve(j(t/8*U.wh.x,n/8*U.wh.y),U.xy),Ue(U.wh,1/16))}function $t(e){let t=He(e,U.xy),n=U.wh.x,r=Math.floor(t.x/n*8),i=Math.floor(t.y/n*8);if(!(r<0||r>7||i<0||i>7))return Ze(r,7-i)}function en(){let e=new Map;for(let t of K)t.sq!==void 0&&e.set(t.pieces,t.sq);return e}var tn={_init(){},_update(e){},_render(){},next_scene(){}},Q,$;function nn(e){$._destroy?.(),$=e}var rn={simulate:Dt};function an(){Q=tn,$=Q,nn(Dt)}function on(e){$!==Q&&(Q=$,Q._init()),Q._update(e);let t=Q.next_scene();t!==void 0&&nn(rn[t]),k.update(e)}function sn(){Q._render()}function cn(){Q._after_render?.()}async function ln(e){let t=Be();t.classList.add(`interactive`),e.appendChild(t),an(),Ne(on,sn,cn)}var un=T(`<div class="min-h-screen flex flex-col"><main class="flex-grow max-w-6xl mx-auto w-full px-4 py-8 lg:py-12">`),dn=T(`<div class=game-wrap>`),fn=T(`<div class="grid lg:grid-cols-12 gap-8 items-start"><div class="lg:col-span-7 xl:col-span-8 flex justify-center"><div class="relative w-full max-w-[600px] aspect-square shadow-2xl rounded-lg overflow-hidden border-4 border-slate-700"></div></div><div class="lg:col-span-5 xl:col-span-4 space-y-6"><div class="bg-slate-900 border border-slate-800 rounded-xl p-6 shadow-sm"><div class="flex items-center justify-between mb-4"><span class="px-2 py-1 bg-slate-800 text-xs font-semibold uppercase tracking-wider text-slate-400 rounded"></span><span class="px-2 py-1 text-xs font-bold rounded bg-green-500/20 text-green-400">Easy</span></div><h1 class="text-2xl font-bold text-white mb-2">puzzle.title</h1><p class="text-slate-400 mb-6 leading-relaxed">puzzle.description</p><div class="flex items-center gap-3 p-4 bg-slate-950/50 rounded-lg border border-slate-800 mb-6"><div class="w-3 h-3 rounded-full bg-slate-600 border border-slate-400"></div><span class="font-semibold text-slate-200">White to Move</span></div><div class="grid grid-cols-2 gap-3"><button class="px-4 py-2 bg-slate-800 hover:bg-slate-700 text-slate-200 rounded-lg font-medium transition-colors border border-slate-700">Reset Board</button><button class="px-4 py-2 bg-slate-800 hover:bg-slate-700 text-slate-200 rounded-lg font-medium transition-colors border border-slate-700 opacity-50 cursor-not-allowed">Hint</button></div></div><div class="text-xs text-center text-slate-600 mt-8">Â© 2026 Mor Chess 3. All rights reserved. <br> Designed with ðŸ’œ.`),pn=T(`<nav class="border-b border-slate-800 bg-slate-900/50 backdrop-blur sticky top-0 z-50"><div class="max-w-6xl mx-auto px-4 h-16 flex items-center justify-between"><div class="flex items-center gap-2"><div class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded flex items-center justify-center text-white font-bold font-serif"><img class="w-9 h-9 rounded"alt=logo src=/logo_big.png></div><span class="text-xl font-bold tracking-tight text-white">Mor Chess 3</span></div><div class="hidden md:flex items-center gap-6 text-sm font-medium text-slate-400"><button class="text-white hover:text-indigo-400 transition-colors">Daily Puzzle</button><button class="hover:text-indigo-400 transition-colors">About</button></div><button title=TODO class="md:hidden text-slate-300"><svg class="w-6 h-6"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M4 6h16M4 12h16m-7 6h7">`),mn=T(`<div class="bg-slate-900 border border-slate-800 rounded-xl p-6 shadow-sm"><h3 class="text-sm font-bold text-slate-400 uppercase tracking-wider mb-4">Your Streak</h3><div class="flex items-end gap-2"><span class="text-4xl font-bold text-white">12</span><span class="text-sm text-slate-500 mb-1">days</span></div><div class="w-full bg-slate-800 h-2 rounded-full mt-4 overflow-hidden"><div class="bg-indigo-500 h-full w-3/4 rounded-full">`);function hn(){return(()=>{var e=un(),t=e.firstChild;return E(e,w(vn,{}),t),E(t,w(_n,{})),e})()}var gn=()=>{let e;return ie(()=>{ln(e)}),(()=>{var t=dn(),n=e;return typeof n==`function`?ke(n,t):e=t,t})()},_n=()=>(()=>{var e=fn(),t=e.firstChild,n=t.firstChild,r=t.nextSibling,i=r.firstChild,a=i.firstChild,o=a.firstChild;o.nextSibling,a.nextSibling.nextSibling.nextSibling.firstChild;var s=i.nextSibling;return E(n,w(gn,{})),E(o,()=>new Date().toLocaleDateString(void 0,{weekday:`long`,month:`long`,day:`numeric`})),E(r,w(yn,{}),s),e})(),vn=()=>pn(),yn=()=>mn();Oe(()=>w(hn,{}),document.getElementById(`root`));